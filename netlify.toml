[build]
  command = "npx prisma generate && npm run build"
  publish = ".next"

[build.environment]
  NODE_VERSION = "22"

# Enable Next.js plugin for dynamic routes and SSR
[[plugins]]
  package = "@netlify/plugin-nextjs"

# Extend function timeout for pipeline API routes (AI generation + image)
[functions]
  external_node_modules = ["@neondatabase/serverless"]
  directory = "netlify/functions"

[functions."___netlify-server-handler"]
  timeout = 300

# Background function for blog generation (up to 15 min)
[functions."generate-blog-background"]
  external_node_modules = ["@neondatabase/serverless", "drizzle-orm"]
